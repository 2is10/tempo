<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Tempo :: Solr Example</title>
	
	<!-- Import the 1KB CSS Grid -->
	<link rel="stylesheet" href="../css/grid.css" type="text/css" media="screen">

	<!-- Import styles for the universal footer -->
	<link rel="stylesheet" href="examples.css" type="text/css" media="screen">

	<style type="text/css" media="screen">
		/* reset and basic typography */
		body {
			margin: 0;
			padding: 0;
			font-family: Helvetica, Arial, sans-serif;
		}
		h1, h2, #solr-facets h3 {
			font-family: Georgia;
			font-weight: normal;
		}
		ol, ul {
			margin: 0;
			padding: 0;
			list-style: none outside none;
		}
		
		/* header */
		#header {
			background-color: black;
			margin-bottom: 2em;
		}
		h1 {
			color: white;
		}
		form {
			float: right;
		}
		form input {
			font-size: 1em;
			margin-top: 1.8em;
		}
		form #query {
			width: 15em;
		}
		
		/* search results */
		h2 {
			color: #999;
			padding: 0 0 0.5em 0;
			margin: 0;
			border-bottom: 1px solid #ccc;
		}
		ol li {
			padding: 1.25em 0;
			border-bottom: 1px solid #e9e9e9;
			text-align: center;
		}
		ol li h3 {
			margin: 0 0 0.25em 0;
			font-family: Georgia;
			font-weight: normal;
			font-size: 1.5em;
			color: #333;
		}
		ol li p {
			margin: 0;
			font-size: 0.9em;
			color: #999;
			text-transform: uppercase;
		}
		
		/* faceted navigation */
		#solr-facets {
			border-left: 1px dotted #ccc;
			padding-left: 49px;
			margin-left: 40px;
		}
		#solr-facets h3 {
			text-transform: capitalize;
			color: #999;
			padding: 0 0 0.7em 0;
			margin: 0.3em 0 0 0;
			border-bottom: 1px solid #ccc;
		}
		#solr-facets ul {
			margin-bottom: 2em;
		}
		#solr-facets ul li li {
			text-transform: capitalize;
			padding: 0.33em 0;
			font-size: 0.95em;
			border-bottom: 1px solid #e9e9e9;
		}
		#solr-facets ul li span {
			color: #999;
			font-family: Georgia;
		}

	</style>
	
	<!-- Import Tempo -->
	<script type="text/javascript" src="../tempo.js"></script>
	
	<!-- This example uses jQuery's ajax() method to retrieve data from Solr -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>

	<script type="text/javascript">
		var solr, facetsTemplate;

		$(document).ready(function() {
			//run Tempo.prepare() on both the response and facet containers
			solr = Tempo.prepare('solr-response');
			facetsTemplate = Tempo.prepare('solr-facets');
			search('literature');
		});

		//retrieve data from Solr
		function search(q) {
			$.ajax({
				url: "http://twigkit.com/data/gutenberg/select/?version=2.2&start=0&rows=10&wt=json&facet=true&facet.limit=10&facet.field=subject&facet.field=language&facet.mincount=1",
				data: {'q': q},
				dataType: 'jsonp',
				jsonp: 'json.wrf',
				success: function(data) {
					//once the data is available, run Tempo.render()
					solr.render(data.response);
					facetsTemplate.render(facets(data.facet_counts.facet_fields));
				}
			});
		}

		//Solr returns facets and facet counts in a strange format, so we'll need to do a bit of pre-processing for sending it off to Tempo.redner()
		function facets(facet_fields) {
			var facets = [];

			for (var field in facet_fields) {
				var f = {'name' : field};

				var facet = [];
				var i = 0;
				while (i < facet_fields[field].length) {
					facet.push({'label': facet_fields[field][i++], 'count': facet_fields[field][i++]});
				}
				f['facet'] = facet;

				facets.push(f);
			}

			return facets;
		}
	</script>
</head>
<body>


<!-- Header -->
<div id="header">
	<div class="row">
		<div class="column grid_6">
			<h1>Tempo + Solr = True Love</h1>
		</div>
		<div class="column grid_6">
			<form id="search" onsubmit="search($('#query').val()); return false;">
				<input type="search" name="query" id="query" placeholder="Search for old books">
				<input type="submit" value="Search" id="submit">
			</form>
		</div>
	</div>
</div>


<!-- Main Body -->
<div id="mainbody" class="row">
	
	<!-- Search Results -->
	<div id="solr-response" class="column grid_8">
		<div data-template style="display: none;">
			<h2>{{numFound}} results found</h2>

			<ol>
				<li data-template="docs">
					<h3>{{title}}</h3>
					<p>by {{creator}}</p>
				</li>
			</ol>
		</div>
	</div>

	<!-- Faceted Navigation -->
	<div id="solr-facets"class="column grid_3">
		<ul>
			<li data-template style="display: none;">
				<h3>{{name}}</h3>
				<ul>
					<li data-template="facet">
						{{label}} <span>{{count}}</span>
					</li>
				</ul>
			</li>
		</ul>
	</div>

</div>


<!-- Universal Footer -->
<ul id="tempo-actions">
	<li><a href="https://twigkit.github.com/tempo/">Back to the Overview</a></li>
	<li class="download"><a href="#">Download Tempo</a></li>
	<li><a href="https://github.com/twigkit/tempo">View on GitHub</a></li>
	<li><a href="#">Google Code</a></li>
</ul>
<div id="footer">
	<div class="row">
		<p class="column grid_12">Brought to you by the friendly guys at <a href="http://twigkit.com/">TwigKit</a>.</p>
	</div>
</div>


</body>
</html>
